{% load static otree %}
<script src="{% static 'main_platform/otree/js/jquery.countdown.min.js' %}"></script>
<script src="{% static 'main_platform/otree/js/jquery.pulsate.min.js' %}"></script>

<script>
    $(function timer() {
        let currentDate = new Date();
        let remainingTimeoutSeconds = {{ view.remaining_timeout_seconds|json }};
        let milliseconds = Math.floor(remainingTimeoutSeconds * 1000);
        $('.otree-timer__time-left').countdown(currentDate.valueOf() + milliseconds)
            .on('update.countdown', function (event) {
                // %-N is "Total count of minutes till the end, non-padded"
                // %S is seconds left
                let format = '%-N:%S';
                $(this).html(event.strftime(format));

                if (format > 10) {
                    console.log(format);
                }

                let pulse = $("#game-timer-container");
                pulse.pulsate({
                    color: "#8B0000",
                    width: 100,
                    react: 40,
                    speed: 2000,
                    pause: 0,
                    glow: true,
                    repeat: true,
                    onHover: false
                });


            })


            .on('finish.countdown', function (event) {
                $('<input>').attr({
                    type: 'hidden',
                    name: 'timeout_happened',
                    value: '1'
                }).appendTo('form');
                $('#form').submit();

            });
        
    });


</script>

