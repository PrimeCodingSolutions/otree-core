{% extends "otree/Base.html" %}
{% load i18n %}
{% load otree otree_internal static %}


{% block internal_styles %}
    {{ block.super }}
    <link href="{% static 'otree/css/styles.css' %}" rel="stylesheet" />
{% endblock %}

{% block internal_scripts %}
{{ block.super }}
<script>
$(function () {
    $('[data-toggle="popover"]').popover()

    // if top menu link is clicked inside iframe
    // we exit full mode
    $("#top_menu a").click(function() {
        if ( window.location !== window.parent.location ) {
                window.parent.location.href = $(this).attr("href");
        }
    });

    // i guess sockets must be global variables, and i should name it
    // something other than 'socket' because there might be other sockets
    // in descendant pages
    var disconnectionSocket;

    function setupDisconnectedAlert() {
        disconnectionSocket = makeReconnectingWebSocket('/no_op/');
        var socket = disconnectionSocket;

        var alertStyle = document.querySelector('#disconnected-alert').style;
        socket.onopen = function (e) {
            alertStyle.visibility = 'hidden';
        };

        socket.onclose = function (e) {
            alertStyle.visibility = 'visible';
        };
    }
    setupDisconnectedAlert();

});

</script>

<script src="{% static 'otree/js/jquery.color-2.1.2.min.js' %}"></script>
<script src="{% static 'otree/js/jquery.timeago.js' %}"></script>
<script src="{% static 'otree/js/jsondiffpatch.min.js' %}"></script>
<script src="{% static 'otree/js/table-utils3.js' %}"></script>

{% endblock %}
{% block body_main %}
    {% if user.is_authenticated and user.is_staff or user.is_superuser %}
    <!-- Navbar when logged in as SUPERUSER or STAFF -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" id="top_menu1">
        <a class="navbar-brand" href="{% url 'games' %}">KU-Læringsspil</a>

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="navbar-collapse collapse" id="navbarSupportedContent1">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link" href="{% url 'games' %}">Forside</a></li>
                <li class="nav-item"><a class="nav-link" href="{% url 'DemoIndex' %}">Demo</a></li>
                <li class="nav-item"><a class="nav-link" href="{% url 'Sessions' %}">Sessions</a></li>
                <li class="nav-item"><a class="nav-link" href="{% url 'Rooms' %}">Rooms</a></li>
                <li class="nav-item"><a class="nav-link" href="{% url 'ExportIndex' %}">Data</a></li>
                <li class="nav-item"><a class="nav-link" href="{% url 'ServerCheck' %}">Server Check</a></li>
                {% if request.user.is_authenticated|default:False %}
                <li><a class="nav-link" href="{% url 'logout' %}">{% trans 'Log out' %}</a></li>

                {% else %}
                <li><a class="nav-link" href="{% url 'login' %}">{% trans 'Log in' %}</a></li>
                {% endif %}
                <li>Bruger: {{ user.username }}</li>
            </ul>
        </div>
    </nav>

{% elif user.is_authenticated and user.is_active %}
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top position-absolute" id="top_menu1">
            <a class="navbar-brand" href="{% url 'home' %}">KU-Læringsspil</a>

            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="navbar-collapse collapse" >
                <ul class="navbar-nav">
                    {% if request.user.is_authenticated|default:False %}
                    <li><a class="nav-link" href="{% url 'logout' %}">{% trans 'Log out' %}</a></li>
                    {% else %}

                    <li><a class="nav-link" href="{% url 'login' %}">{% trans 'Log in' %}</a></li>
                    {% endif %}
                </ul>
            </div>
        </nav>
{% else %}
  <nav class="navbar navbar-expand-lg fixed-top position-absolute" id="top_menu1">
  <div class="container-fluid">
  <!--  <a class="navbar-brand"  href="{% url 'games' %}">
        <img class="navbar-brand" src="../../static/otree/media/mellem-logokusvg.svg" alt="" height="100px" width="100px">

  </a>-->

    <ul class="nav navbar-nav ml-auto login-nav">
      <li>
            {% if request.user.is_authenticated|default:False %}
                <a class="navbar-link login-button" href="{% url 'logout' %}">{% trans 'Log out' %}</a>
            {% else %}
                <a class="navbar-link login-button" href="{% url 'login' %}">{% trans 'Log in' %}</a>
            {% endif %}
      </li>
    </ul>
  </div>
</nav>

{% endif %}
    <div>
        {% block menus %}{% endblock %}
    <div>
        {% block content %}{% endblock %}
    </div>
    <br/>
</div>


    {% comment %}

     <div class="page-header" >
        <h2>{% block title %}{% endblock %}</h2>
    </div>

      this exists so that if there is an error in oTree's channel consumers,
      such as data export or rooms, the user gets some notification rather than it silently
      failing.
      don't put it in global base template even though it could be useful there too,
      because we don't want to pollute "view source"
      in user-defined pages
    {% endcomment %}
    <div id='websocket-server-error' class="top-left-fixed-alert"></div>
{% endblock body_main %}
