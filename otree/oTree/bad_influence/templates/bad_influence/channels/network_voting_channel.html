<script>
    $(function () {
        let ws_scheme = window.location.protocol === "https:" ? "wss" : "ws";
        let ws_path = ws_scheme + '://' + window.location.host + "/ws/network_voting/{{ player.id }}/{{ group.pk }}";
        let socket = new WebSocket(ws_path);

        let $guess_true_button = $('#GuessTrueButton');
        let $guess_false_button = $('#GuessFalseButton');
        let $consensus_bar = $('#ConsensusBar');

        let send_guess = function (guess) {
            let message = {
                'action': 'guess',
                'payload': guess,
                'subjective_time': timer.innerText
            };

            socket.send(JSON.stringify({
                'message': message
            }));

            console.log("Message Send")
        };

        $guess_true_button.click(function () {
            console.log("Button clicked.");
            send_guess(true);
        });
        $guess_false_button.click(function () {
            console.log("Button clicked.");
            send_guess(false);
        });

        socket.onmessage = event => {
            console.log("Message received");
            console.log(event);
            let obj = JSON.parse(event.data).message;
            let new_consensus = (obj.consensus * 100).toFixed(0) + "%";
            $consensus_bar.html(new_consensus);
            $consensus_bar.attr('aria-valuenow', new_consensus).css('width', new_consensus);
            setNodeColors(obj.ego_graph.nodes);
        };
    })
    ;
</script>