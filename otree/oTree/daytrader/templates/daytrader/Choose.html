{% extends "global/Base.html" %}
{% load staticfiles otree %}

{% block title %}
    {{ player.company_name }}
{% endblock %}

{% block content %}

    {% if subsession.round_number > 1 %}
        <p>
        <table class="table">
            <tr>
                <th>trader</th>
                <th>pris</th>
                <th>ansigt</th>
                <th>handel</th>
            </tr>
            {% for r, price, choice, deals, states in data %}
                <tr>
                    <td> {{ r }}.</td>
                    <td> {{ price|c }}</td>
                    <td class="faceContainer">
                        <div class="btn-container"></div>
                        {% if states is True %}
                            <div class="state-container">Glad :-)</div>
                        {% else %}
                            <div class="state-container">Ked af det :-(</div>
                        {% endif %}
                    </td>
                    <td> {% if choice == True %} + {% else %} - {% endif %}
                        {{ deals }} aktier
                    </td>
                </tr>
            {% endfor %}
        </table>
        <p> Nu er du trader nummer {{ player.round_number }},
    {% else %}
        Du er den første trader,
    {% endif %}
og du skal nu handle aktier i firmaet '{{ player.company_name }}'.
Du kigger i sækken, og ser et ansigt der er
{% if player.drawn_face == True %}
    <strong>glad</strong>
{% else %}
    <strong>ked af det</strong>
{% endif %}.
</p>
    <p>
        Du har {{ player.wallet|c }} og aktieprisen er lige nu {{ player.price|c }}. Hvad vil du gøre?
    </p>
    {% formfield player.choice_of_trade label=None %}
    <p> Hvor mange aktier? (du kan handle med maksimalt {{ player.can_buy }} aktier)</p>
    {% formfield player.choice_of_number_of_shares label=None %}
    {% next_button %}

    <script>
        let containers = document.getElementsByClassName("faceContainer");
        let drawn_face = {{ player.drawn_face|yesno:"true,false" }};
        let states = document.getElementsByClassName("state-container");
        let buttonContainer = document.getElementsByClassName("btn-container");
        window.localStorage.setItem("clicked", "false");

        function toggle(className, displayState) {
            let elements = document.getElementsByClassName(className);

            for (let i = 0; i < elements.length; i++) {
                elements[i].style.display = displayState;
            }
        }


        for (let i = 0; i < containers.length; i++) {
            states[i].style.display = "none";
            let button = document.createElement("button");
            button.className = "btn btn-primary reveal-btn";
            button.textContent = "?";
            containers[i].appendChild(button);
        }

        let button = document.getElementsByClassName("reveal-btn");
        if(window.localStorage.getItem("clicked") !== "true") {
            for (let item = 0; item < button.length; item++) {
                button[item].onclick = event => {
                    event.preventDefault();
                    toggle("reveal-btn", "none");
                    states[item].style.display = "block";
                }
            }

        }
    </script>

{% endblock %}
