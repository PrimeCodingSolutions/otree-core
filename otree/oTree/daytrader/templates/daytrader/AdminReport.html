{% load otree %}
{% block content %}
    <style>
        body {
            background: #41739D;
        }

        ._otree-content {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #timer {
            display: flex;
            justify-content: center;
        }

        #daytrader-admin-table {
            width: 50%;
        }

        #form {
            display: none;
        }

    </style>


    <embed src="{% static 'daytrader/test.png' %}" class="graph-image"/>

    <p class="report-description">Nedenunder kan du se en tabel der viser firmaernes tilstande og spillets forløb</p>

    <p class="report-description">Et grønt plus repræsenterer at gå long</p>
    <p class="report-description">Et gult minus repræsenterer at gå short</p>

    <table id="tableReport" class="table daytrader-table table-responsive">
        <tr id="removeLast" class="table-corners">
            <th class="daytrader-table-header border-corner-left"> firma</th>
            <th class="daytrader-table-header"> tilstand</th>
            {% for r in round_list %}
                <th class="daytrader-table-header right text-center" id="round_{{ r }}"> {{ r }} </th>
            {% endfor %}
        </tr>
        {#                {% for navn, tilstand, valg, drawn_faces in company %}#}
        {#                    <tr class="daytrader-table-row">#}
        {#                        <td class="daytrader-table-data"> {{ navn }} </td>#}
        {#                        <td class="daytrader-table-data admin-table-data">#}
        {#                            <div class="admin-sack-button-container">#}
        {#                                {% for state in tilstand %}#}
        {#                                    {% if state == 1 %}#}
        {#                                        <embed src="{% static 'daytrader/media/happy_face_daytrader.png' %}"#}
        {#                                               class="company-face admin-table-face-{{ forloop.counter }}"/>#}
        {#                                    {% else %}#}
        {#                                        <embed src="{% static 'daytrader/media/sad_face_daytrader.png' %}"#}
        {#                                               class="company-face admin-table-face-{{ forloop.counter }}"/>#}
        {#                                    {% endif %}#}
        {#                                {% endfor %}#}
        {#                            </div>#}
        {##}
        {#                        </td>#}
        {##}
        {#                        <td class="daytrader-table-data">#}
        {#                            {% for choice in valg %}#}
        {#                                {% if choice is 1 %}#}
        {#                                    <img src="{% static 'daytrader/media/green-plus.svg' %}" alt="green plus"#}
        {#                                         class="company-face">#}
        {#                                {% endif %}#}
        {#                            {% endfor %}#}
        {##}
        {#                            {% for state in drawn_faces %}#}
        {#                                {% if state is True %}#}
        {#                                    <img src="{% static 'daytrader/media/happy_face_daytrader.png' %}" alt="happy face"#}
        {#                                         class="company-face">#}
        {#                                {% else %}#}
        {#                                    <img src="{% static 'daytrader/media/sad_face_daytrader.png' %}" alt="sad face"#}
        {#                                         class="company-face">#}
        {#                                {% endif %}#}
        {#                            {% endfor %}#}
        {##}
        {#                            {% for choice in valg %}#}
        {#                                {% if choice is 0 %}#}
        {#                                    <img src="{% static 'daytrader/media/yellow-minus.svg' %}" alt="yellow minus"#}
        {#                                         class="company-face">#}
        {#                                {% endif %}#}
        {#                            {% endfor %}#}
        {##}
        {#                            {% for state in drawn_faces %}#}
        {#                                {% if state is False %}#}
        {#                                    <img src="{% static 'daytrader/media/sad_face_daytrader.png' %}" alt="sad face"#}
        {#                                         class="company-face">#}
        {#                                {% else %}#}
        {#                                    <img src="{% static 'daytrader/media/happy_face_daytrader.png' %}" alt="happy face"#}
        {#                                         class="company-face">#}
        {#                                {% endif %}#}
        {#                            {% endfor %}#}
        {#                        </td>#}
        {##}
        {#                    </tr>#}
        {##}
        {##}
        {#                {% endfor %}#}

        {% for navn, tilstand, valg, ansigter in company %}
            <tr class="daytrader-table-row">
                <td class="daytrader-table-data">{{ navn }}</td>
                <td class="daytrader-table-data admin-table-data">
                    <div class="admin-sack-button-container">
                        {% for state in tilstand %}
                            {% if state == 1 %}
                                <embed src="{% static 'daytrader/media/happy_face_daytrader.png' %}"
                                       class="company-face admin-table-face-{{ forloop.counter }}"/>
                            {% else %}
                                <embed src="{% static 'daytrader/media/sad_face_daytrader.png' %}"
                                       class="company-face admin-table-face-{{ forloop.counter }}"/>
                            {% endif %}
                        {% endfor %}
                    </div>
                </td>
                {% for state in valg %}
                    <td class="daytrader-table-data get-col">
                        <div class="face-container">

                            {% if state == 1 %}
                                <img src="{% static 'daytrader/media/green-plus.svg' %}" alt="green plus"
                                     class="company-face">
                            {% else %}
                                <img src="{% static 'daytrader/media/yellow-minus.svg' %}" alt="yellow minus"
                                     class="company-face">
                            {% endif %}
                        </div>
                    </td>
                {% endfor %}
            </tr>
        {% endfor %}


    </table>

    <div>
    <h2 class="rapport-header ">Topscorerliste</h2>



    <table class="table results-table table-responsive">
            <tr>
                <th> </th>
                <th> spiller <br> nr. </th>
                <th> tjent <br> ialt </th>
            </tr>
            {% for ranking in rankings %}
            <tr>
                <td> <strong>{{ forloop.counter }}</strong> </td>
                <td> {{ ranking.0 }} </td>
                <td> {{ ranking.1 }} </td>
            </tr>
            {% endfor %}
    </table>



{% endblock %}

<script>
    // Remove last table column if row exceeds 2 columns
    let rowLength = document.getElementById("removeLast");
    let rowCount = document.getElementsByTagName("th").length;
    let tableHeaders = document.getElementsByClassName("daytrader-table-header");
    let table = document.getElementById("tableReport");
    let drawn_faces = {{ faces|json }};
    let faces = []
    let faceContainer = document.getElementsByClassName("face-container");

    drawn_faces.map(item => {
        item.map(element => {
            faces.push(element);
        })
    })

    for (let i = 0; i < faceContainer.length; i++) {
        faceContainer[i].style.display = "flex";
        faceContainer[i].style.flexDirection = "column";
        faceContainer[i].style.alignItems = "center";

        let face = faces[i];
        let happyFace = document.createElement("img");
        happyFace.className = "company-face";
        happyFace.src = "{% static 'daytrader/media/happy_face_daytrader.png' %}";

        let sadFace = document.createElement("img");
        sadFace.className = "company-face";
        sadFace.src = "{% static 'daytrader/media/sad_face_daytrader.png' %}";

        if (face === true) {
            faceContainer[i].appendChild(happyFace);
        } else {
            faceContainer[i].appendChild(sadFace);

        }
    }

    if (rowCount > 2) {
        rowLength.deleteCell(-1);
    }

    for (let item = 0; item < tableHeaders.length; item++) {
        tableHeaders[tableHeaders.length - 1].style.borderRadius = "0 10px 10px 0";
    }
</script>
